<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Buddy Allocator: buddy.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Buddy Allocator
   &#160;<span id="projectnumber">0.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">buddy.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="buddy_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">/**************************************************************************</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * Conditional Compilation Options</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> **************************************************************************/</span></div><div class="line"><a name="l00009"></a><span class="lineno"><a class="line" href="buddy_8c.html#a260e435d62aa44fda8a1368df99c4a89">    9</a></span>&#160;<span class="preprocessor">#define USE_DEBUG 0</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">/**************************************************************************</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * Included Files</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> **************************************************************************/</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &lt;stdlib.h&gt;</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &lt;assert.h&gt;</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="buddy_8h.html">buddy.h</a>&quot;</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="list_8h.html">list.h</a>&quot;</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">/**************************************************************************</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"> * Public Definitions</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"> **************************************************************************/</span></div><div class="line"><a name="l00025"></a><span class="lineno"><a class="line" href="buddy_8c.html#a23bae2b7cd4008c90256be146e21cccf">   25</a></span>&#160;<span class="preprocessor">#define MIN_ORDER 12    // Represents the power of 2 of the minimum block size in bytes</span></div><div class="line"><a name="l00026"></a><span class="lineno"><a class="line" href="buddy_8c.html#ab08dffec08ac450d78d4c062b571939e">   26</a></span>&#160;<span class="preprocessor">#define MAX_ORDER 20    // Represents the power of 2 of the maximum block size in bytes</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div><div class="line"><a name="l00028"></a><span class="lineno"><a class="line" href="buddy_8c.html#a7d467c1d283fdfa1f2081ba1e0d01b6e">   28</a></span>&#160;<span class="preprocessor">#define PAGE_SIZE (1&lt;&lt;MIN_ORDER)    // Represents the size of a page in bytes</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">/* page index to address */</span></div><div class="line"><a name="l00031"></a><span class="lineno"><a class="line" href="buddy_8c.html#a7c13b46aacf7af9976a7f058076c81a3">   31</a></span>&#160;<span class="preprocessor">#define PAGE_TO_ADDR(page_idx) (void *)((page_idx*PAGE_SIZE) + g_memory)</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">/* address to page index */</span></div><div class="line"><a name="l00034"></a><span class="lineno"><a class="line" href="buddy_8c.html#aa44fbfb588ad3483e93dfc7fd28b2afd">   34</a></span>&#160;<span class="preprocessor">#define ADDR_TO_PAGE(addr) ((unsigned long)((void *)addr - (void *)g_memory) / PAGE_SIZE)</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">/* find buddy address */</span></div><div class="line"><a name="l00037"></a><span class="lineno"><a class="line" href="buddy_8c.html#aae7263f0e40a1e0dfefa6f53652a4a05">   37</a></span>&#160;<span class="preprocessor">#define BUDDY_ADDR(addr, o) (void *)((((unsigned long)addr - (unsigned long)g_memory) ^ (1&lt;&lt;o)) \</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">                                     + (unsigned long)g_memory)</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#if USE_DEBUG == 1</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#  define PDEBUG(fmt, ...) \</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">    fprintf(stderr, &quot;%s(), %s:%d: &quot; fmt,            \</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">        __func__, __FILE__, __LINE__, ##__VA_ARGS__)</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#  define IFDEBUG(x) x</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00046"></a><span class="lineno"><a class="line" href="buddy_8c.html#a9077500d1488a75e4eec5eeb1131655e">   46</a></span>&#160;<span class="preprocessor">#  define PDEBUG(fmt, ...)</span></div><div class="line"><a name="l00047"></a><span class="lineno"><a class="line" href="buddy_8c.html#abcf0d5a50dd7e407cd464c1afbd27554">   47</a></span>&#160;<span class="preprocessor">#  define IFDEBUG(x)</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment">/**************************************************************************</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment"> * Public Types</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment"> **************************************************************************/</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div><div class="line"><a name="l00063"></a><span class="lineno"><a class="line" href="structblock__t.html">   63</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span>{</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="comment">/* Usage notes</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment">     * Every list member has a member called list_head, because the Linux</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">     * kernel uses a circular linked list scheme.</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">     * list_head is used internally, and we need only to include it in our</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">     * struct and initialize it to be able to use a linked list.</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">     * When an individual element is initialized, its next and previous</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">     * pointer are set to itself.</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">     */</span></div><div class="line"><a name="l00077"></a><span class="lineno"><a class="line" href="structblock__t.html#a80d7be33d943c2f81034b125405a3dd4">   77</a></span>&#160;    <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a> <a class="code" href="notes_8txt.html#a4ee6db26bad3dd738a9a0384595fe358">list</a>;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="comment">// The address where this page begins</span></div><div class="line"><a name="l00080"></a><span class="lineno"><a class="line" href="structblock__t.html#aa2cbb00c1f450c796b741e1e5b0867bf">   80</a></span>&#160;    <span class="keywordtype">char</span>* <a class="code" href="structblock__t.html#aa2cbb00c1f450c796b741e1e5b0867bf">address</a>;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="comment">// The power of 2 representing the number of bytes in this block</span></div><div class="line"><a name="l00083"></a><span class="lineno"><a class="line" href="structblock__t.html#a82acc515c2099fec50f6f0b41bfb19ad">   83</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="structblock__t.html#a82acc515c2099fec50f6f0b41bfb19ad">order</a>;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="comment">// Is this page free</span></div><div class="line"><a name="l00086"></a><span class="lineno"><a class="line" href="structblock__t.html#a623e67fc2865af94d9d86a7e99de20e4">   86</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="structblock__t.html#a623e67fc2865af94d9d86a7e99de20e4">isFree</a>;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;} <a class="code" href="structblock__t.html">block_t</a>;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment">/**************************************************************************</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment"> * Global Variables</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment"> **************************************************************************/</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">/* free lists, store structs representing pages in blocks of various orders */</span></div><div class="line"><a name="l00096"></a><span class="lineno"><a class="line" href="buddy_8c.html#a6d390a89d1f6c149cef6284d2c0351df">   96</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a> <a class="code" href="buddy_8c.html#a6d390a89d1f6c149cef6284d2c0351df">free_area</a>[<a class="code" href="buddy_8c.html#ab08dffec08ac450d78d4c062b571939e">MAX_ORDER</a>+1];</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment"> * memory area, no real use beyond the macros and initialization</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment"> * In fact, this is only still here because it was included code...</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00102"></a><span class="lineno"><a class="line" href="buddy_8c.html#ad6d688a63e574ba24b0247b2bec1e31d">  102</a></span>&#160;<span class="keywordtype">char</span> <a class="code" href="buddy_8c.html#ad6d688a63e574ba24b0247b2bec1e31d">g_memory</a>[1&lt;&lt;<a class="code" href="buddy_8c.html#ab08dffec08ac450d78d4c062b571939e">MAX_ORDER</a>];</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">/* block structures */</span></div><div class="line"><a name="l00105"></a><span class="lineno"><a class="line" href="buddy_8c.html#a0c59228921651aa21b1411571fcf6147">  105</a></span>&#160;<a class="code" href="structblock__t.html">block_t</a> <a class="code" href="buddy_8c.html#a0c59228921651aa21b1411571fcf6147">g_pages</a>[(1&lt;&lt;<a class="code" href="buddy_8c.html#ab08dffec08ac450d78d4c062b571939e">MAX_ORDER</a>)/<a class="code" href="buddy_8c.html#a7d467c1d283fdfa1f2081ba1e0d01b6e">PAGE_SIZE</a>];</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment">/**************************************************************************</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment"> * Public Function Prototypes</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment"> **************************************************************************/</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">/**************************************************************************</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment"> * Private Definitions</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment"> **************************************************************************/</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">// Helpers</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">// Merge two blocks, and move to the next highest order.</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="keywordtype">void</span> <a class="code" href="buddy_8c.html#a291be3a0fdc0a7ec9c808e87c62c2385">merge</a>(<a class="code" href="structblock__t.html">block_t</a> *block, <a class="code" href="structblock__t.html">block_t</a> *buddy);</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">// Print a graph of the current allocations</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="keywordtype">void</span> <a class="code" href="buddy_8c.html#a8bec8ecb275b3b38660e8f1ff1bb6fce">print_free_area</a>();</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">// Count and report number of block_t elements in the free_area of the</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">// specified order</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="keywordtype">void</span> <a class="code" href="buddy_8c.html#a163818df92461e2dc01f190f17493a1b">count_blocks</a>(<span class="keyword">struct</span> <a class="code" href="structlist__head.html">list_head</a> * theList);</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment">// Print block information for a specific block</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="keywordtype">void</span> <a class="code" href="buddy_8c.html#a3a4add9f9079c0eabd81e1da0c12ae6a">print_block</a>(<a class="code" href="structblock__t.html">block_t</a> * pg);</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment">// Locate and return a pointer to the first free block in a given order for</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment">// free_area, or NULL if no such block exists.</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<a class="code" href="structblock__t.html">block_t</a>* <a class="code" href="buddy_8c.html#a2f7a9bf73e255fb58bf8e57855e67532">find_free_block</a>(<span class="keywordtype">int</span> <a class="code" href="notes_8txt.html#ae170b788b9ce36849b8a92724a029135">order</a>);</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">// Print block information for all free_area members, along with counts of</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment">// each size block among all possible sizes</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="keywordtype">void</span> <a class="code" href="buddy_8c.html#a77eea0047539c2e97bf94de50ccdf9f7">buddy_dump_verbose</a>();</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment">// Print counts of each size block among all possible sizes in free_area</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="keywordtype">void</span> <a class="code" href="buddy_8c.html#aa16d99b90dd0a6b9d7e3db0573620c21">buddy_dump</a>();</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment">// Returns a pointer to the buddy block with the given address if it exists in</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">// the free_area, or NULL otherwise</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<a class="code" href="structblock__t.html">block_t</a>* <a class="code" href="buddy_8c.html#abdfe2346b53850f10cb4cb70a79e6334">find_block</a>(<span class="keywordtype">char</span>* addr, <span class="keywordtype">int</span> <a class="code" href="notes_8txt.html#ae170b788b9ce36849b8a92724a029135">order</a>);</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">/**************************************************************************</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment"> * Local Functions</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment"> **************************************************************************/</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;</div><div class="line"><a name="l00157"></a><span class="lineno"><a class="line" href="buddy_8h.html#a6674e7c974485f8a5dd8874e9eb125f3">  157</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="buddy_8c.html#a6674e7c974485f8a5dd8874e9eb125f3">buddy_init</a>()</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;{</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="preprocessor">#if USE_DEBUG</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    printf(<span class="stringliteral">&quot;Initializing buddy allocator...\n&quot;</span>);</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="keywordtype">int</span> n_pages = (1&lt;&lt;<a class="code" href="buddy_8c.html#ab08dffec08ac450d78d4c062b571939e">MAX_ORDER</a>) / <a class="code" href="buddy_8c.html#a7d467c1d283fdfa1f2081ba1e0d01b6e">PAGE_SIZE</a>;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="comment">/* initialize freelist */</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="keywordflow">for</span> (i = <a class="code" href="buddy_8c.html#a23bae2b7cd4008c90256be146e21cccf">MIN_ORDER</a>; i &lt;= <a class="code" href="buddy_8c.html#ab08dffec08ac450d78d4c062b571939e">MAX_ORDER</a>; i++) {</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        <a class="code" href="list_8h.html#a0ffe9d28c36d7b018a9cfae33bae45c0">INIT_LIST_HEAD</a>(&amp;<a class="code" href="buddy_8c.html#a6d390a89d1f6c149cef6284d2c0351df">free_area</a>[i]);</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    }</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; n_pages; i++) {</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        <span class="comment">//block_t *temp = (block_t*)malloc(sizeof(block_t));</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        <span class="comment">//g_pages[i] = *temp;</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        <span class="comment">// Initialize this as a linked list element</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        <a class="code" href="list_8h.html#a0ffe9d28c36d7b018a9cfae33bae45c0">INIT_LIST_HEAD</a>(&amp;<a class="code" href="buddy_8c.html#a0c59228921651aa21b1411571fcf6147">g_pages</a>[i].<a class="code" href="notes_8txt.html#a4ee6db26bad3dd738a9a0384595fe358">list</a>);</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        <span class="comment">// All start as free</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        <a class="code" href="buddy_8c.html#a0c59228921651aa21b1411571fcf6147">g_pages</a>[i].<a class="code" href="structblock__t.html#a623e67fc2865af94d9d86a7e99de20e4">isFree</a> = 1;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        <span class="comment">// All start in highest order</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        <a class="code" href="buddy_8c.html#a0c59228921651aa21b1411571fcf6147">g_pages</a>[i].<a class="code" href="structblock__t.html#a82acc515c2099fec50f6f0b41bfb19ad">order</a> = <a class="code" href="buddy_8c.html#ab08dffec08ac450d78d4c062b571939e">MAX_ORDER</a>;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <span class="comment">// Address is increments of page size from start</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        <span class="comment">//(g_pages[i].address) = (g_memory + (i*PAGE_SIZE));</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        <a class="code" href="buddy_8c.html#a0c59228921651aa21b1411571fcf6147">g_pages</a>[i].<a class="code" href="structblock__t.html#aa2cbb00c1f450c796b741e1e5b0867bf">address</a> = (<span class="keywordtype">char</span>*)<a class="code" href="buddy_8c.html#a7c13b46aacf7af9976a7f058076c81a3">PAGE_TO_ADDR</a>(i);</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    </div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    }</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    </div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="comment">/* add the entire memory as a single free block */</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <a class="code" href="list_8h.html#a0373c4b3c8ce51a451a569ad978b32e1">list_add</a>(&amp;<a class="code" href="buddy_8c.html#a0c59228921651aa21b1411571fcf6147">g_pages</a>[0].<a class="code" href="notes_8txt.html#a4ee6db26bad3dd738a9a0384595fe358">list</a>, &amp;<a class="code" href="buddy_8c.html#a6d390a89d1f6c149cef6284d2c0351df">free_area</a>[<a class="code" href="buddy_8c.html#ab08dffec08ac450d78d4c062b571939e">MAX_ORDER</a>]);</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        </div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="preprocessor">#if USE_DEBUG</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    printf(<span class="stringliteral">&quot;Done\n&quot;</span>);</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;}</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div><div class="line"><a name="l00218"></a><span class="lineno"><a class="line" href="buddy_8h.html#a8197baf99e89c859b5326a1d455680fd">  218</a></span>&#160;<span class="keywordtype">void</span> *<a class="code" href="buddy_8c.html#a8197baf99e89c859b5326a1d455680fd">buddy_alloc</a>(<span class="keywordtype">int</span> size)</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;{</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="comment">     * Basic idea:</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment">     *  The only thing necessary to represent a block in memory is its</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment">     *  starting address and how big it is as a whole(order).</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="comment">     *  </span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="comment">     *  If we maintain this scheme, we need only move around the</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment">     *  minimum number of block types (***NOT PAGE TYPES***).  The</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment">     *  rubric and lecture materials are a pedagogical nightmare.</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment">     *  Let&#39;s call one thing a page, and other things something else!</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment">     *</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment">     *  After identifying the smallest order with a free block, along</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment">     *  with the target order of the given allocation size, we can</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment">     *  determine the number of splits for each.  </span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">     * */</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="preprocessor">#if USE_DEBUG</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    printf(<span class="stringliteral">&quot;Attempting to allocate for size %d...\n&quot;</span>, size);</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="comment">// Check that size is valid</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="keywordflow">if</span>(size &gt; (1 &lt;&lt; <a class="code" href="buddy_8c.html#ab08dffec08ac450d78d4c062b571939e">MAX_ORDER</a>) || size &lt; 0){</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        printf(<span class="stringliteral">&quot;[ INVALID SIZE ERROR : MAX SIZE IS %d BYTES ]\n&quot;</span>, (1 &lt;&lt; <a class="code" href="buddy_8c.html#ab08dffec08ac450d78d4c062b571939e">MAX_ORDER</a>));</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        <span class="keywordflow">return</span> NULL;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    }</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <span class="keywordtype">int</span> num_splits = 0;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <span class="keywordtype">int</span> target_order = <a class="code" href="buddy_8c.html#ab08dffec08ac450d78d4c062b571939e">MAX_ORDER</a>;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="keywordtype">int</span> active_order = -1;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <span class="comment">// Shuffling list members</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <a class="code" href="structblock__t.html">block_t</a> *lefty;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <a class="code" href="structblock__t.html">block_t</a> *righty;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="preprocessor">#if USE_DEBUG</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    printf(<span class="stringliteral">&quot;Allocation is not too big...\n&quot;</span>);</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="keywordflow">if</span>(size &lt;= (1 &lt;&lt; <a class="code" href="buddy_8c.html#a23bae2b7cd4008c90256be146e21cccf">MIN_ORDER</a>)){</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        target_order = <a class="code" href="buddy_8c.html#a23bae2b7cd4008c90256be146e21cccf">MIN_ORDER</a>;   </div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    }</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="keywordflow">else</span>{</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        <span class="comment">// While the size we are looking at, divided by two, is larger than</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        <span class="comment">// the allocation size...</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        <span class="keywordflow">while</span>(size &lt;= (1 &lt;&lt;(target_order-1))){</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        </div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;            <span class="comment">// Update order for allocation</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;            target_order--;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        }</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    }</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="comment">//Starting from the target order, find the smallest free_area with</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="comment">//free blocks</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <span class="keywordflow">for</span>(active_order = target_order; active_order &lt;= <a class="code" href="buddy_8c.html#ab08dffec08ac450d78d4c062b571939e">MAX_ORDER</a>; active_order++){</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        <span class="keywordflow">if</span>(NULL != <a class="code" href="buddy_8c.html#a2f7a9bf73e255fb58bf8e57855e67532">find_free_block</a>(active_order)){</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        }</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(active_order == <a class="code" href="buddy_8c.html#ab08dffec08ac450d78d4c062b571939e">MAX_ORDER</a>){</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;            printf(<span class="stringliteral">&quot;[ OUT OF MEMORY ERROR ]\n&quot;</span>);</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;            <span class="keywordflow">return</span> NULL;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        }</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        <span class="keywordflow">else</span>{</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="preprocessor">#if USE_DEBUG</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;            printf(<span class="stringliteral">&quot;Order %d has no free blocks...\n&quot;</span>, active_order);   </div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        }</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    }</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="preprocessor">#if USE_DEBUG</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    printf(<span class="stringliteral">&quot;Settled on order %d (%d bytes) for size %d...\n&quot;</span>, target_order, (1&lt;&lt;target_order), size);</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <span class="comment">// Make sure that we have free memory to allocate the requested size</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    assert((1 &lt;&lt; active_order) &gt;= size);</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="preprocessor">#if USE_DEBUG</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    printf(<span class="stringliteral">&quot;We have enough memory to perform the allocation...\n&quot;</span>);</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    printf(<span class="stringliteral">&quot;The smallest block size with free pages is order %d (%d bytes)\n&quot;</span>, active_order, (1 &lt;&lt; active_order));</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="comment">// Determine how many splits need to take place</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    num_splits = active_order - target_order;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="comment">// Retrieve the first empty block</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    lefty = <a class="code" href="buddy_8c.html#a2f7a9bf73e255fb58bf8e57855e67532">find_free_block</a>(active_order);</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    </div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    assert(NULL != lefty);</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    </div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="keywordflow">if</span>(0 == num_splits){</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        <span class="comment">// Since we are already at the target order, simply mark the</span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        <span class="comment">// first free entry as taken and return its address.</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        lefty-&gt;<a class="code" href="structblock__t.html#a623e67fc2865af94d9d86a7e99de20e4">isFree</a> = 0;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    }</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <span class="keywordflow">else</span>{</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="preprocessor">#if USE_DEBUG</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        printf(<span class="stringliteral">&quot;Removing left half from current active list...\n&quot;</span>);</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        <a class="code" href="buddy_8c.html#a163818df92461e2dc01f190f17493a1b">count_blocks</a>(&amp;<a class="code" href="buddy_8c.html#a6d390a89d1f6c149cef6284d2c0351df">free_area</a>[active_order]);</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        </div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    </div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        <span class="comment">// Need to remove the left from this order</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        <a class="code" href="list_8h.html#ab1708206f0f7e0a56550b35372203ba5">list_del</a>(&amp;lefty-&gt;<a class="code" href="structblock__t.html#a80d7be33d943c2f81034b125405a3dd4">list</a>);</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        </div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        <span class="comment">//count_blocks(&amp;free_area[active_order]);</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        <span class="keywordflow">while</span>(num_splits &gt; 0){</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;            <span class="comment">// Determine the right half side start address from the left half.  Retrieve the</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;            <span class="comment">// associated page from g_pages. Use the enxt lowest</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;            <span class="comment">// order since we are breaking this downward</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;            <span class="keywordtype">char</span> * right_addr = <a class="code" href="buddy_8c.html#aae7263f0e40a1e0dfefa6f53652a4a05">BUDDY_ADDR</a>(lefty-&gt;<a class="code" href="structblock__t.html#aa2cbb00c1f450c796b741e1e5b0867bf">address</a>, (active_order-1));</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;            righty = &amp;<a class="code" href="buddy_8c.html#a0c59228921651aa21b1411571fcf6147">g_pages</a>[<a class="code" href="buddy_8c.html#aa44fbfb588ad3483e93dfc7fd28b2afd">ADDR_TO_PAGE</a>(right_addr)];</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;            righty-&gt;<a class="code" href="structblock__t.html#a82acc515c2099fec50f6f0b41bfb19ad">order</a> = active_order-1;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;            righty-&gt;<a class="code" href="structblock__t.html#a623e67fc2865af94d9d86a7e99de20e4">isFree</a> = 1;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;            righty-&gt;<a class="code" href="structblock__t.html#aa2cbb00c1f450c796b741e1e5b0867bf">address</a> = right_addr;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;            </div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;            </div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="preprocessor">#if USE_DEBUG</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;            printf(<span class="stringliteral">&quot;Right half at order %d will have address %p\n&quot;</span>, righty-&gt;<a class="code" href="structblock__t.html#a82acc515c2099fec50f6f0b41bfb19ad">order</a>, right_addr);</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;            printf(<span class="stringliteral">&quot;Adding right half to next lowest order...\n&quot;</span>);</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;            <a class="code" href="buddy_8c.html#a163818df92461e2dc01f190f17493a1b">count_blocks</a>(&amp;<a class="code" href="buddy_8c.html#a6d390a89d1f6c149cef6284d2c0351df">free_area</a>[active_order-1]);</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;            <span class="comment">// Add the right half to the free_area of the next lowest order.</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;            <a class="code" href="list_8h.html#a0373c4b3c8ce51a451a569ad978b32e1">list_add</a>(&amp;righty-&gt;<a class="code" href="structblock__t.html#a80d7be33d943c2f81034b125405a3dd4">list</a>, &amp;<a class="code" href="buddy_8c.html#a6d390a89d1f6c149cef6284d2c0351df">free_area</a>[active_order-1]);</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="preprocessor">#if USE_DEBUG</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;            <a class="code" href="buddy_8c.html#a163818df92461e2dc01f190f17493a1b">count_blocks</a>(&amp;<a class="code" href="buddy_8c.html#a6d390a89d1f6c149cef6284d2c0351df">free_area</a>[active_order-1]);</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;            <span class="comment">// Sanity Check:</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;            <a class="code" href="structblock__t.html">block_t</a> * temp = <a class="code" href="list_8h.html#a26c976b7f654e70df318c1843e5094de">list_entry</a>(<a class="code" href="buddy_8c.html#a6d390a89d1f6c149cef6284d2c0351df">free_area</a>[active_order-1].<a class="code" href="structlist__head.html#ac3b0ff0dfb978a0cfbdad6b9d19cdcfe">next</a>, <a class="code" href="structblock__t.html">block_t</a>, <a class="code" href="notes_8txt.html#a4ee6db26bad3dd738a9a0384595fe358">list</a>);</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;            assert(temp-&gt;<a class="code" href="structblock__t.html#aa2cbb00c1f450c796b741e1e5b0867bf">address</a> == righty-&gt;<a class="code" href="structblock__t.html#aa2cbb00c1f450c796b741e1e5b0867bf">address</a>);</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;            active_order--;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;            </div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;            num_splits--;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        }</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        assert(active_order == target_order);</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        <span class="comment">// By this point, active_order should equal target order.  All that</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        <span class="comment">// remains to do is to adjust the size of lefty, set it to in use, and</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        <span class="comment">// add it to the back of the current list</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        lefty-&gt;<a class="code" href="structblock__t.html#a623e67fc2865af94d9d86a7e99de20e4">isFree</a> = 0;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        lefty-&gt;<a class="code" href="structblock__t.html#a82acc515c2099fec50f6f0b41bfb19ad">order</a> = active_order;</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        <a class="code" href="list_8h.html#a588bec046f1e9797b33a5c5ab250f447">list_add_tail</a>(&amp;lefty-&gt;<a class="code" href="structblock__t.html#a80d7be33d943c2f81034b125405a3dd4">list</a>, &amp;<a class="code" href="buddy_8c.html#a6d390a89d1f6c149cef6284d2c0351df">free_area</a>[active_order]);</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    } <span class="comment">// End if(0 == num_splits)</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="preprocessor">#if USE_DEBUG</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <a class="code" href="buddy_8c.html#a8bec8ecb275b3b38660e8f1ff1bb6fce">print_free_area</a>();</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    </div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <span class="keywordflow">return</span> lefty-&gt;<a class="code" href="structblock__t.html#aa2cbb00c1f450c796b741e1e5b0867bf">address</a>;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;}</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;</div><div class="line"><a name="l00395"></a><span class="lineno"><a class="line" href="buddy_8h.html#a961ef8a2fd9df43d50945100f172b97a">  395</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="buddy_8c.html#a961ef8a2fd9df43d50945100f172b97a">buddy_free</a>(<span class="keywordtype">void</span> *addr)</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;{</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <span class="keywordtype">int</span> current_order;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <a class="code" href="structblock__t.html">block_t</a> *block = NULL;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <a class="code" href="structblock__t.html">block_t</a> *buddy = NULL;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="comment">// Locate the block associate with the address passed in</span></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <span class="comment">// if it does not exist, error out</span></div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <span class="keywordflow">for</span>(current_order=<a class="code" href="buddy_8c.html#a23bae2b7cd4008c90256be146e21cccf">MIN_ORDER</a>; current_order &lt; <a class="code" href="buddy_8c.html#ab08dffec08ac450d78d4c062b571939e">MAX_ORDER</a>; ++current_order){</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;        block = <a class="code" href="buddy_8c.html#abdfe2346b53850f10cb4cb70a79e6334">find_block</a>(addr, current_order);</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        <span class="keywordflow">if</span>(NULL != block){</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;            <span class="keywordflow">break</span>;  </div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        }</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    }</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="preprocessor">#if USE_DEBUG</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <span class="keywordflow">if</span>(NULL == block){</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        printf(<span class="stringliteral">&quot;[ FREE ERROR: FREE ON FREE PAGE ]\n&quot;</span>);</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    }</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <span class="keywordflow">else</span>{</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        printf(<span class="stringliteral">&quot;FREEING BLOCK OF ORDER %d (%d bytes)\n&quot;</span>, block-&gt;<a class="code" href="structblock__t.html#a82acc515c2099fec50f6f0b41bfb19ad">order</a>, (1 &lt;&lt; block-&gt;<a class="code" href="structblock__t.html#a82acc515c2099fec50f6f0b41bfb19ad">order</a>));</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        printf(<span class="stringliteral">&quot;LOCATED THE GIVEN BLOCK...\n&quot;</span>);</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    }</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    <span class="comment">//  Merging follows the pattern:</span></div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    <span class="comment">//</span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    <span class="comment">//  Search for a buddy at the current order.</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    <span class="comment">//  </span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    <span class="comment">//  If the buddy is not free, this block remains here and is</span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    <span class="comment">//  marked as free.  Update its order and return.</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <span class="comment">//  </span></div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    <span class="comment">//  If the buddy does not exist, we assume that we are done.  Free</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    <span class="comment">//  this block, adjust the order, and return.</span></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <span class="comment">//</span></div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <span class="comment">//  Otherwise, merge the two into the block at hand, change the</span></div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <span class="comment">//  order, and add to the next list up. Repeat.</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <span class="comment">//</span></div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    </div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <span class="comment">// Identify the buddy address which goes with the given address</span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <span class="keywordtype">char</span>* buddy_addr = (<span class="keywordtype">char</span>*)<a class="code" href="buddy_8c.html#aae7263f0e40a1e0dfefa6f53652a4a05">BUDDY_ADDR</a>(addr, block-&gt;<a class="code" href="structblock__t.html#a82acc515c2099fec50f6f0b41bfb19ad">order</a>);</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="comment">// locate the block which begins with this address in the free_areas</span></div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    buddy = <a class="code" href="buddy_8c.html#abdfe2346b53850f10cb4cb70a79e6334">find_block</a>(buddy_addr, block-&gt;<a class="code" href="structblock__t.html#a82acc515c2099fec50f6f0b41bfb19ad">order</a>);</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <span class="keywordflow">while</span>(NULL != buddy){</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        <span class="keywordflow">if</span>(1 == buddy-&gt;<a class="code" href="structblock__t.html#a623e67fc2865af94d9d86a7e99de20e4">isFree</a>){</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;<span class="preprocessor">#if USE_DEBUG</span></div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;            printf(<span class="stringliteral">&quot;Found free buddy %p\n&quot;</span>, buddy-&gt;<a class="code" href="structblock__t.html#aa2cbb00c1f450c796b741e1e5b0867bf">address</a>);</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;            printf(<span class="stringliteral">&quot;Removing from order %d\n&quot;</span>, block-&gt;<a class="code" href="structblock__t.html#a82acc515c2099fec50f6f0b41bfb19ad">order</a>);</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;            <span class="comment">// Remove both blocks from the current free_area</span></div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;            <a class="code" href="list_8h.html#ab1708206f0f7e0a56550b35372203ba5">list_del</a>(&amp;buddy-&gt;<a class="code" href="structblock__t.html#a80d7be33d943c2f81034b125405a3dd4">list</a>);</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;            <a class="code" href="list_8h.html#ab1708206f0f7e0a56550b35372203ba5">list_del</a>(&amp;block-&gt;<a class="code" href="structblock__t.html#a80d7be33d943c2f81034b125405a3dd4">list</a>);</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;            <span class="comment">// Destroy the block with the larger address. Undangle it.</span></div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;            <span class="keywordflow">if</span>(block-&gt;<a class="code" href="structblock__t.html#aa2cbb00c1f450c796b741e1e5b0867bf">address</a> &lt; buddy-&gt;<a class="code" href="structblock__t.html#aa2cbb00c1f450c796b741e1e5b0867bf">address</a>){</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;                buddy = NULL;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;            }</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;            <span class="keywordflow">else</span>{</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                block = buddy;</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;                buddy = NULL;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;            }</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;            </div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;            <span class="comment">// Update the order for this block and add it to that free_area</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;            <span class="keywordflow">if</span>(block-&gt;<a class="code" href="structblock__t.html#a82acc515c2099fec50f6f0b41bfb19ad">order</a> &lt; MAX_ORDER){</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;                block-&gt;<a class="code" href="structblock__t.html#a82acc515c2099fec50f6f0b41bfb19ad">order</a>++;</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;            }</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;<span class="preprocessor">#if USE_DEBUG</span></div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;            printf(<span class="stringliteral">&quot;Adding merged block to order %d\n&quot;</span>, block-&gt;<a class="code" href="structblock__t.html#a82acc515c2099fec50f6f0b41bfb19ad">order</a>);</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;            <a class="code" href="buddy_8c.html#a163818df92461e2dc01f190f17493a1b">count_blocks</a>(&amp;<a class="code" href="buddy_8c.html#a6d390a89d1f6c149cef6284d2c0351df">free_area</a>[block-&gt;<a class="code" href="structblock__t.html#a82acc515c2099fec50f6f0b41bfb19ad">order</a>]);</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;            <span class="comment">// Add the merged block to the now higher order or</span></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;            <span class="comment">// block sizes</span></div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;            <a class="code" href="list_8h.html#a0373c4b3c8ce51a451a569ad978b32e1">list_add</a>(&amp;block-&gt;<a class="code" href="structblock__t.html#a80d7be33d943c2f81034b125405a3dd4">list</a>, &amp;<a class="code" href="buddy_8c.html#a6d390a89d1f6c149cef6284d2c0351df">free_area</a>[block-&gt;<a class="code" href="structblock__t.html#a82acc515c2099fec50f6f0b41bfb19ad">order</a>]);</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;<span class="preprocessor">#if USE_DEBUG</span></div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;            <a class="code" href="buddy_8c.html#a163818df92461e2dc01f190f17493a1b">count_blocks</a>(&amp;<a class="code" href="buddy_8c.html#a6d390a89d1f6c149cef6284d2c0351df">free_area</a>[block-&gt;<a class="code" href="structblock__t.html#a82acc515c2099fec50f6f0b41bfb19ad">order</a>]);</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;            <span class="comment">// Get a new buddy address</span></div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;            buddy_addr = (<span class="keywordtype">char</span>*)<a class="code" href="buddy_8c.html#aae7263f0e40a1e0dfefa6f53652a4a05">BUDDY_ADDR</a>(block-&gt;<a class="code" href="structblock__t.html#aa2cbb00c1f450c796b741e1e5b0867bf">address</a>, block-&gt;<a class="code" href="structblock__t.html#a82acc515c2099fec50f6f0b41bfb19ad">order</a>);</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;            <span class="comment">// Search for another buddy</span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;            buddy = <a class="code" href="buddy_8c.html#abdfe2346b53850f10cb4cb70a79e6334">find_block</a>(buddy_addr, block-&gt;<a class="code" href="structblock__t.html#a82acc515c2099fec50f6f0b41bfb19ad">order</a>);</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;        }</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;        <span class="keywordflow">else</span>{</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="preprocessor">#if USE_DEBUG</span></div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;            printf(<span class="stringliteral">&quot;Buddy %p is still busy, freeing block...\n&quot;</span>, buddy-&gt;<a class="code" href="structblock__t.html#aa2cbb00c1f450c796b741e1e5b0867bf">address</a>);</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;            <span class="comment">// Buddy is still in use, exit and return</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;            buddy = NULL;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;        }</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    }<span class="comment">// End while(NULL != buddy)</span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    </div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    <span class="comment">// Mark block as freed</span></div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    block-&gt;<a class="code" href="structblock__t.html#a623e67fc2865af94d9d86a7e99de20e4">isFree</a> = 1;</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;<span class="preprocessor">#if USE_DEBUG</span></div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    <a class="code" href="buddy_8c.html#a8bec8ecb275b3b38660e8f1ff1bb6fce">print_free_area</a>();</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    </div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;}</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;</div><div class="line"><a name="l00520"></a><span class="lineno"><a class="line" href="buddy_8h.html#aa16d99b90dd0a6b9d7e3db0573620c21">  520</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="buddy_8c.html#aa16d99b90dd0a6b9d7e3db0573620c21">buddy_dump</a>()</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;{</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="preprocessor">#if USE_DEBUG</span></div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    <a class="code" href="buddy_8c.html#a77eea0047539c2e97bf94de50ccdf9f7">buddy_dump_verbose</a>();</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    <span class="keywordtype">int</span> o;</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    <span class="keywordflow">for</span> (o = <a class="code" href="buddy_8c.html#a23bae2b7cd4008c90256be146e21cccf">MIN_ORDER</a>; o &lt;= <a class="code" href="buddy_8c.html#ab08dffec08ac450d78d4c062b571939e">MAX_ORDER</a>; o++) {</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;        <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a> *pos;</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;        <span class="keywordtype">int</span> cnt = 0;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;        <a class="code" href="list_8h.html#ab8b24e6660ab3760c923e4b4db3fa502">list_for_each</a>(pos, &amp;<a class="code" href="buddy_8c.html#a6d390a89d1f6c149cef6284d2c0351df">free_area</a>[o]) {</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;            <a class="code" href="structblock__t.html">block_t</a> * temp = <a class="code" href="list_8h.html#a26c976b7f654e70df318c1843e5094de">list_entry</a>(pos, <a class="code" href="structblock__t.html">block_t</a>, <a class="code" href="notes_8txt.html#a4ee6db26bad3dd738a9a0384595fe358">list</a>);</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;            <span class="keywordflow">if</span>(temp-&gt;<a class="code" href="structblock__t.html#a623e67fc2865af94d9d86a7e99de20e4">isFree</a> == 1){</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;                cnt++;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;            }</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;        }</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;        printf(<span class="stringliteral">&quot;%d:%dK &quot;</span>, cnt, (1&lt;&lt;o)/1024);</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    }</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    printf(<span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;}</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;</div><div class="line"><a name="l00545"></a><span class="lineno"><a class="line" href="buddy_8c.html#a77eea0047539c2e97bf94de50ccdf9f7">  545</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="buddy_8c.html#a77eea0047539c2e97bf94de50ccdf9f7">buddy_dump_verbose</a>(){</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    <span class="keywordtype">int</span> o;</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    <span class="keywordflow">for</span> (o = <a class="code" href="buddy_8c.html#a23bae2b7cd4008c90256be146e21cccf">MIN_ORDER</a>; o &lt;= <a class="code" href="buddy_8c.html#ab08dffec08ac450d78d4c062b571939e">MAX_ORDER</a>; o++) {</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;        <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a> *pos;</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        <span class="keywordtype">int</span> cnt = 0;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;        <span class="keywordtype">int</span> total = 0;</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;        <a class="code" href="list_8h.html#ab8b24e6660ab3760c923e4b4db3fa502">list_for_each</a>(pos, &amp;<a class="code" href="buddy_8c.html#a6d390a89d1f6c149cef6284d2c0351df">free_area</a>[o]) {</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;            <a class="code" href="structblock__t.html">block_t</a> * temp = <a class="code" href="list_8h.html#a26c976b7f654e70df318c1843e5094de">list_entry</a>(pos, <a class="code" href="structblock__t.html">block_t</a>, <a class="code" href="notes_8txt.html#a4ee6db26bad3dd738a9a0384595fe358">list</a>);</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;            total++;</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;            <span class="keywordflow">if</span>(1 == temp-&gt;<a class="code" href="structblock__t.html#a623e67fc2865af94d9d86a7e99de20e4">isFree</a>){</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;                cnt++;</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;            }</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        }</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;        printf(<span class="stringliteral">&quot;(%d/%d):%dK &quot;</span>, cnt, total, (1&lt;&lt;o)/1024);</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    }</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    printf(<span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    </div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;}</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;<span class="comment"> * @brief Merge a block with its buddy and move to the next highest order.</span></div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;<span class="comment"> * @note This function was left in because it has weird scoping issues.</span></div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="comment"> * TODO Figure out why changes herein are not persistent in the block_t types</span></div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;<span class="comment"> * passed in.</span></div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00573"></a><span class="lineno"><a class="line" href="buddy_8c.html#a291be3a0fdc0a7ec9c808e87c62c2385">  573</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="buddy_8c.html#a291be3a0fdc0a7ec9c808e87c62c2385">merge</a>(<a class="code" href="structblock__t.html">block_t</a> *block, <a class="code" href="structblock__t.html">block_t</a> *buddy){</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <span class="comment">// Remove both blocks from the current free_area</span></div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    <a class="code" href="list_8h.html#ab1708206f0f7e0a56550b35372203ba5">list_del</a>(&amp;buddy-&gt;<a class="code" href="structblock__t.html#a80d7be33d943c2f81034b125405a3dd4">list</a>);</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <a class="code" href="list_8h.html#ab1708206f0f7e0a56550b35372203ba5">list_del</a>(&amp;block-&gt;<a class="code" href="structblock__t.html#a80d7be33d943c2f81034b125405a3dd4">list</a>);</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    <span class="comment">// Destroy the block with the larger address. Undangle it.</span></div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    <span class="keywordflow">if</span>(block-&gt;<a class="code" href="structblock__t.html#aa2cbb00c1f450c796b741e1e5b0867bf">address</a> &lt; buddy-&gt;<a class="code" href="structblock__t.html#aa2cbb00c1f450c796b741e1e5b0867bf">address</a>){</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        buddy = NULL;</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    }</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    <span class="keywordflow">else</span>{</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;        block = buddy;</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;        buddy = NULL;</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    }</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;            </div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <span class="comment">// Update the order for this block and add it to that free_area</span></div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    <span class="keywordflow">if</span>(block-&gt;<a class="code" href="structblock__t.html#a82acc515c2099fec50f6f0b41bfb19ad">order</a> &lt; <a class="code" href="buddy_8c.html#ab08dffec08ac450d78d4c062b571939e">MAX_ORDER</a>){</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;        block-&gt;<a class="code" href="structblock__t.html#a82acc515c2099fec50f6f0b41bfb19ad">order</a>++;</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    }</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="preprocessor">#if USE_DEBUG</span></div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    printf(<span class="stringliteral">&quot;Adding merged block to order %d\n&quot;</span>, block-&gt;<a class="code" href="structblock__t.html#a82acc515c2099fec50f6f0b41bfb19ad">order</a>);</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <a class="code" href="buddy_8c.html#a163818df92461e2dc01f190f17493a1b">count_blocks</a>(&amp;<a class="code" href="buddy_8c.html#a6d390a89d1f6c149cef6284d2c0351df">free_area</a>[block-&gt;<a class="code" href="structblock__t.html#a82acc515c2099fec50f6f0b41bfb19ad">order</a>]);</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    <a class="code" href="list_8h.html#a0373c4b3c8ce51a451a569ad978b32e1">list_add</a>(&amp;block-&gt;<a class="code" href="structblock__t.html#a80d7be33d943c2f81034b125405a3dd4">list</a>, &amp;<a class="code" href="buddy_8c.html#a6d390a89d1f6c149cef6284d2c0351df">free_area</a>[block-&gt;<a class="code" href="structblock__t.html#a82acc515c2099fec50f6f0b41bfb19ad">order</a>]);</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;<span class="preprocessor">#if USE_DEBUG</span></div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <a class="code" href="buddy_8c.html#a163818df92461e2dc01f190f17493a1b">count_blocks</a>(&amp;<a class="code" href="buddy_8c.html#a6d390a89d1f6c149cef6284d2c0351df">free_area</a>[block-&gt;<a class="code" href="structblock__t.html#a82acc515c2099fec50f6f0b41bfb19ad">order</a>]);</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;}</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;</div><div class="line"><a name="l00609"></a><span class="lineno"><a class="line" href="buddy_8c.html#a8bec8ecb275b3b38660e8f1ff1bb6fce">  609</a></span>&#160;<span class="keywordtype">void</span>  <a class="code" href="buddy_8c.html#a8bec8ecb275b3b38660e8f1ff1bb6fce">print_free_area</a>(){</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    </div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    <span class="keywordflow">for</span>(i=<a class="code" href="buddy_8c.html#ab08dffec08ac450d78d4c062b571939e">MAX_ORDER</a>; i &gt;= <a class="code" href="buddy_8c.html#a23bae2b7cd4008c90256be146e21cccf">MIN_ORDER</a>; i--){</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a> *pos;</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;        printf(<span class="stringliteral">&quot;Order %d, %d bytes\n&quot;</span>, i, (1 &lt;&lt; i));</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;        printf(<span class="stringliteral">&quot; --------------------------------------------------------------- \n&quot;</span>);</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;        printf(<span class="stringliteral">&quot; | &quot;</span>);</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;        <a class="code" href="list_8h.html#ab8b24e6660ab3760c923e4b4db3fa502">list_for_each</a>(pos, &amp;<a class="code" href="buddy_8c.html#a6d390a89d1f6c149cef6284d2c0351df">free_area</a>[i]){</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;            <a class="code" href="structblock__t.html">block_t</a> * temp = <a class="code" href="list_8h.html#a26c976b7f654e70df318c1843e5094de">list_entry</a>(pos, <a class="code" href="structblock__t.html">block_t</a>, <a class="code" href="notes_8txt.html#a4ee6db26bad3dd738a9a0384595fe358">list</a>);</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;            <span class="keywordflow">if</span>(1 == temp-&gt;<a class="code" href="structblock__t.html#a623e67fc2865af94d9d86a7e99de20e4">isFree</a>){</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;                printf(<span class="stringliteral">&quot;%p, F&quot;</span>, temp-&gt;<a class="code" href="structblock__t.html#aa2cbb00c1f450c796b741e1e5b0867bf">address</a>);</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;            }</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;            <span class="keywordflow">else</span>{</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;                printf(<span class="stringliteral">&quot;%p, A&quot;</span>, temp-&gt;<a class="code" href="structblock__t.html#aa2cbb00c1f450c796b741e1e5b0867bf">address</a>); </div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;            }</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;            printf(<span class="stringliteral">&quot; | &quot;</span>);</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;        }</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;        printf(<span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;        printf(<span class="stringliteral">&quot; --------------------------------------------------------------- \n&quot;</span>);</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    }</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    </div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;}</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;</div><div class="line"><a name="l00637"></a><span class="lineno"><a class="line" href="buddy_8c.html#a163818df92461e2dc01f190f17493a1b">  637</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="buddy_8c.html#a163818df92461e2dc01f190f17493a1b">count_blocks</a>(<span class="keyword">struct</span> <a class="code" href="structlist__head.html">list_head</a>* theList){</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    </div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    <span class="keywordtype">int</span> count = 0;</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a> * pos;</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    <a class="code" href="list_8h.html#ab8b24e6660ab3760c923e4b4db3fa502">list_for_each</a>(pos, theList){</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;        count++;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    }</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    printf(<span class="stringliteral">&quot;The given list has %d block entries\n&quot;</span>, count);</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;}</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;</div><div class="line"><a name="l00651"></a><span class="lineno"><a class="line" href="buddy_8c.html#a3a4add9f9079c0eabd81e1da0c12ae6a">  651</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="buddy_8c.html#a3a4add9f9079c0eabd81e1da0c12ae6a">print_block</a>(<a class="code" href="structblock__t.html">block_t</a> * block){</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    printf(<span class="stringliteral">&quot;Block Summary: (order, address, isFree)-&gt;(%d, %p, %s)\n&quot;</span>, block-&gt;<a class="code" href="structblock__t.html#a82acc515c2099fec50f6f0b41bfb19ad">order</a>, block-&gt;<a class="code" href="structblock__t.html#aa2cbb00c1f450c796b741e1e5b0867bf">address</a>, block-&gt;<a class="code" href="structblock__t.html#a623e67fc2865af94d9d86a7e99de20e4">isFree</a> == 1 ? <span class="stringliteral">&quot;FREE&quot;</span>: <span class="stringliteral">&quot;NOT FREE&quot;</span>);</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;}</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;</div><div class="line"><a name="l00660"></a><span class="lineno"><a class="line" href="buddy_8c.html#a2f7a9bf73e255fb58bf8e57855e67532">  660</a></span>&#160;<a class="code" href="structblock__t.html">block_t</a>* <a class="code" href="buddy_8c.html#a2f7a9bf73e255fb58bf8e57855e67532">find_free_block</a>(<span class="keywordtype">int</span> <a class="code" href="notes_8txt.html#ae170b788b9ce36849b8a92724a029135">order</a>){</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    <a class="code" href="structblock__t.html">block_t</a> * ret;</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a> * p;</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    <a class="code" href="list_8h.html#ab8b24e6660ab3760c923e4b4db3fa502">list_for_each</a>(p, &amp;<a class="code" href="buddy_8c.html#a6d390a89d1f6c149cef6284d2c0351df">free_area</a>[order]){</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;        ret = <a class="code" href="list_8h.html#a26c976b7f654e70df318c1843e5094de">list_entry</a>(p, <a class="code" href="structblock__t.html">block_t</a>, <a class="code" href="notes_8txt.html#a4ee6db26bad3dd738a9a0384595fe358">list</a>);</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        <span class="keywordflow">if</span>(1 == ret-&gt;<a class="code" href="structblock__t.html#a623e67fc2865af94d9d86a7e99de20e4">isFree</a>){</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;            <span class="keywordflow">return</span> ret; </div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;        }</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    }</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    <span class="keywordflow">return</span> NULL;</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;}</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;</div><div class="line"><a name="l00680"></a><span class="lineno"><a class="line" href="buddy_8c.html#abdfe2346b53850f10cb4cb70a79e6334">  680</a></span>&#160;<a class="code" href="structblock__t.html">block_t</a>* <a class="code" href="buddy_8c.html#abdfe2346b53850f10cb4cb70a79e6334">find_block</a>(<span class="keywordtype">char</span>* addr, <span class="keywordtype">int</span> <a class="code" href="notes_8txt.html#ae170b788b9ce36849b8a92724a029135">order</a>){</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;<span class="preprocessor">#if USE_DEBUG</span></div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    printf(<span class="stringliteral">&quot;Searching order %d for %p...\n&quot;</span>, order, addr);</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    <a class="code" href="structblock__t.html">block_t</a> * ret;</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    <span class="keyword">struct </span><a class="code" href="structlist__head.html">list_head</a> *p;</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    <a class="code" href="list_8h.html#ab8b24e6660ab3760c923e4b4db3fa502">list_for_each</a>(p, &amp;<a class="code" href="buddy_8c.html#a6d390a89d1f6c149cef6284d2c0351df">free_area</a>[order]){</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;        ret = <a class="code" href="list_8h.html#a26c976b7f654e70df318c1843e5094de">list_entry</a>(p, <a class="code" href="structblock__t.html">block_t</a>, <a class="code" href="notes_8txt.html#a4ee6db26bad3dd738a9a0384595fe358">list</a>);</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;        <span class="keywordflow">if</span>(ret-&gt;<a class="code" href="structblock__t.html#aa2cbb00c1f450c796b741e1e5b0867bf">address</a> == addr){</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;<span class="preprocessor">#if USE_DEBUG</span></div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;            printf(<span class="stringliteral">&quot;Found block with address %p!\n&quot;</span>, ret-&gt;<a class="code" href="structblock__t.html#aa2cbb00c1f450c796b741e1e5b0867bf">address</a>);</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;            <span class="keywordflow">return</span> ret; </div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;        }</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;<span class="preprocessor">#if USE_DEBUG</span></div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;        <span class="keywordflow">else</span>{</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;            printf(<span class="stringliteral">&quot;%p doesn&#39;t match target %p, moving on...\n&quot;</span>, ret-&gt;<a class="code" href="structblock__t.html#aa2cbb00c1f450c796b741e1e5b0867bf">address</a>, addr);   </div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;        }</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    }</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;<span class="preprocessor">#if USE_DEBUG</span></div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    printf(<span class="stringliteral">&quot;BLOCK %p NOT FOUND at order %d...\n&quot;</span>, addr, order);</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    <span class="keywordflow">return</span> NULL;</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;}</div><div class="ttc" id="buddy_8c_html_a7d467c1d283fdfa1f2081ba1e0d01b6e"><div class="ttname"><a href="buddy_8c.html#a7d467c1d283fdfa1f2081ba1e0d01b6e">PAGE_SIZE</a></div><div class="ttdeci">#define PAGE_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="buddy_8c_source.html#l00028">buddy.c:28</a></div></div>
<div class="ttc" id="list_8h_html_a0373c4b3c8ce51a451a569ad978b32e1"><div class="ttname"><a href="list_8h.html#a0373c4b3c8ce51a451a569ad978b32e1">list_add</a></div><div class="ttdeci">static void list_add(struct list_head *new, struct list_head *head)</div><div class="ttdef"><b>Definition:</b> <a href="list_8h_source.html#l00058">list.h:58</a></div></div>
<div class="ttc" id="notes_8txt_html_ae170b788b9ce36849b8a92724a029135"><div class="ttname"><a href="notes_8txt.html#ae170b788b9ce36849b8a92724a029135">order</a></div><div class="ttdeci">Initialize the buddy system We begin with the entirety of memory in the largest free_area list Since our minimum order we allocate at least every time This is the initial we find the smallest list with a free entry this will be only the list Say we have a worst case we need only a single page We will find the and need to decide if we need to split How will splitting work need to find the smallest list with a free chunk of pages if that page can be we need to load all the pages into the next smallest list We know the size of the current so we can determine the number of pages to push Pages must be pushed in order</div><div class="ttdef"><b>Definition:</b> <a href="notes_8txt_source.html#l00008">notes.txt:8</a></div></div>
<div class="ttc" id="buddy_8c_html_a0c59228921651aa21b1411571fcf6147"><div class="ttname"><a href="buddy_8c.html#a0c59228921651aa21b1411571fcf6147">g_pages</a></div><div class="ttdeci">block_t g_pages[(1&lt;&lt; MAX_ORDER)/PAGE_SIZE]</div><div class="ttdef"><b>Definition:</b> <a href="buddy_8c_source.html#l00105">buddy.c:105</a></div></div>
<div class="ttc" id="structlist__head_html_ac3b0ff0dfb978a0cfbdad6b9d19cdcfe"><div class="ttname"><a href="structlist__head.html#ac3b0ff0dfb978a0cfbdad6b9d19cdcfe">list_head::next</a></div><div class="ttdeci">struct list_head * next</div><div class="ttdef"><b>Definition:</b> <a href="list_8h_source.html#l00022">list.h:22</a></div></div>
<div class="ttc" id="buddy_8c_html_aa44fbfb588ad3483e93dfc7fd28b2afd"><div class="ttname"><a href="buddy_8c.html#aa44fbfb588ad3483e93dfc7fd28b2afd">ADDR_TO_PAGE</a></div><div class="ttdeci">#define ADDR_TO_PAGE(addr)</div><div class="ttdef"><b>Definition:</b> <a href="buddy_8c_source.html#l00034">buddy.c:34</a></div></div>
<div class="ttc" id="buddy_8c_html_a291be3a0fdc0a7ec9c808e87c62c2385"><div class="ttname"><a href="buddy_8c.html#a291be3a0fdc0a7ec9c808e87c62c2385">merge</a></div><div class="ttdeci">void merge(block_t *block, block_t *buddy)</div><div class="ttdef"><b>Definition:</b> <a href="buddy_8c_source.html#l00573">buddy.c:573</a></div></div>
<div class="ttc" id="buddy_8c_html_abdfe2346b53850f10cb4cb70a79e6334"><div class="ttname"><a href="buddy_8c.html#abdfe2346b53850f10cb4cb70a79e6334">find_block</a></div><div class="ttdeci">block_t * find_block(char *addr, int order)</div><div class="ttdoc">Locate and return a pointer to the block with the given address within the free area of the given ord...</div><div class="ttdef"><b>Definition:</b> <a href="buddy_8c_source.html#l00680">buddy.c:680</a></div></div>
<div class="ttc" id="list_8h_html_ab8b24e6660ab3760c923e4b4db3fa502"><div class="ttname"><a href="list_8h.html#ab8b24e6660ab3760c923e4b4db3fa502">list_for_each</a></div><div class="ttdeci">#define list_for_each(pos, head)</div><div class="ttdef"><b>Definition:</b> <a href="list_8h_source.html#l00198">list.h:198</a></div></div>
<div class="ttc" id="buddy_8c_html_ad6d688a63e574ba24b0247b2bec1e31d"><div class="ttname"><a href="buddy_8c.html#ad6d688a63e574ba24b0247b2bec1e31d">g_memory</a></div><div class="ttdeci">char g_memory[1&lt;&lt; MAX_ORDER]</div><div class="ttdef"><b>Definition:</b> <a href="buddy_8c_source.html#l00102">buddy.c:102</a></div></div>
<div class="ttc" id="buddy_8c_html_aae7263f0e40a1e0dfefa6f53652a4a05"><div class="ttname"><a href="buddy_8c.html#aae7263f0e40a1e0dfefa6f53652a4a05">BUDDY_ADDR</a></div><div class="ttdeci">#define BUDDY_ADDR(addr, o)</div><div class="ttdef"><b>Definition:</b> <a href="buddy_8c_source.html#l00037">buddy.c:37</a></div></div>
<div class="ttc" id="structlist__head_html"><div class="ttname"><a href="structlist__head.html">list_head</a></div><div class="ttdef"><b>Definition:</b> <a href="list_8h_source.html#l00021">list.h:21</a></div></div>
<div class="ttc" id="buddy_8c_html_aa16d99b90dd0a6b9d7e3db0573620c21"><div class="ttname"><a href="buddy_8c.html#aa16d99b90dd0a6b9d7e3db0573620c21">buddy_dump</a></div><div class="ttdeci">void buddy_dump()</div><div class="ttdoc">print free pages in each order. </div><div class="ttdef"><b>Definition:</b> <a href="buddy_8c_source.html#l00520">buddy.c:520</a></div></div>
<div class="ttc" id="buddy_8h_html"><div class="ttname"><a href="buddy_8h.html">buddy.h</a></div></div>
<div class="ttc" id="list_8h_html_ab1708206f0f7e0a56550b35372203ba5"><div class="ttname"><a href="list_8h.html#ab1708206f0f7e0a56550b35372203ba5">list_del</a></div><div class="ttdeci">static void list_del(struct list_head *entry)</div><div class="ttdef"><b>Definition:</b> <a href="list_8h_source.html#l00094">list.h:94</a></div></div>
<div class="ttc" id="buddy_8c_html_a163818df92461e2dc01f190f17493a1b"><div class="ttname"><a href="buddy_8c.html#a163818df92461e2dc01f190f17493a1b">count_blocks</a></div><div class="ttdeci">void count_blocks(struct list_head *theList)</div><div class="ttdoc">Count and report the number of blocks in a given free_area member. </div><div class="ttdef"><b>Definition:</b> <a href="buddy_8c_source.html#l00637">buddy.c:637</a></div></div>
<div class="ttc" id="buddy_8c_html_ab08dffec08ac450d78d4c062b571939e"><div class="ttname"><a href="buddy_8c.html#ab08dffec08ac450d78d4c062b571939e">MAX_ORDER</a></div><div class="ttdeci">#define MAX_ORDER</div><div class="ttdef"><b>Definition:</b> <a href="buddy_8c_source.html#l00026">buddy.c:26</a></div></div>
<div class="ttc" id="buddy_8c_html_a23bae2b7cd4008c90256be146e21cccf"><div class="ttname"><a href="buddy_8c.html#a23bae2b7cd4008c90256be146e21cccf">MIN_ORDER</a></div><div class="ttdeci">#define MIN_ORDER</div><div class="ttdef"><b>Definition:</b> <a href="buddy_8c_source.html#l00025">buddy.c:25</a></div></div>
<div class="ttc" id="list_8h_html_a588bec046f1e9797b33a5c5ab250f447"><div class="ttname"><a href="list_8h.html#a588bec046f1e9797b33a5c5ab250f447">list_add_tail</a></div><div class="ttdeci">static void list_add_tail(struct list_head *new, struct list_head *head)</div><div class="ttdef"><b>Definition:</b> <a href="list_8h_source.html#l00071">list.h:71</a></div></div>
<div class="ttc" id="notes_8txt_html_a4ee6db26bad3dd738a9a0384595fe358"><div class="ttname"><a href="notes_8txt.html#a4ee6db26bad3dd738a9a0384595fe358">list</a></div><div class="ttdeci">Initialize the buddy system We begin with the entirety of memory in the largest free_area list Since our minimum order we allocate at least every time This is the initial we find the smallest list with a free entry this will be only the list Say we have a worst case we need only a single page We will find the and need to decide if we need to split How will splitting work need to find the smallest list with a free chunk of pages if that page can be we need to load all the pages into the next smallest list We know the size of the current so we can determine the number of pages to push Pages must be pushed in since we need to maintain order within chunks It might also be wise to mark the pages as written and add that half of pages to the back of the list The instructions say to always take the head of the list when checking the free which ties into why this method is fast enough in the first so we shouldn t violate that Something to consider is that it is not clear whether the used pages belong in the free_area or not The name suggests but the comments seem to contradict this The first step when allocating a block is checking IF the head of the matching list is free This indicates that the FREE_AREA contains NONFREE chunks WTF How will joining work set each page to free While doing retain the pointer to the final member of the list If our buddy is it will always be at the current level Chunks will be not be but pages within chunks will Thus we need to identify the index of the first page within our buddy s and scan through the list for that index When we find we need one more list pointer to get the end of the first chunk This will allow us to set its next to the head of the second and the previous of the second chunk s head to the tail of the first chunk After the joining is the pages should be added in order to the next size up of memory pool When pages are they should be tracked in a separate list</div><div class="ttdef"><b>Definition:</b> <a href="notes_8txt_source.html#l00008">notes.txt:8</a></div></div>
<div class="ttc" id="list_8h_html"><div class="ttname"><a href="list_8h.html">list.h</a></div></div>
<div class="ttc" id="buddy_8c_html_a3a4add9f9079c0eabd81e1da0c12ae6a"><div class="ttname"><a href="buddy_8c.html#a3a4add9f9079c0eabd81e1da0c12ae6a">print_block</a></div><div class="ttdeci">void print_block(block_t *pg)</div><div class="ttdoc">Print information for a given block. </div><div class="ttdef"><b>Definition:</b> <a href="buddy_8c_source.html#l00651">buddy.c:651</a></div></div>
<div class="ttc" id="buddy_8c_html_a8bec8ecb275b3b38660e8f1ff1bb6fce"><div class="ttname"><a href="buddy_8c.html#a8bec8ecb275b3b38660e8f1ff1bb6fce">print_free_area</a></div><div class="ttdeci">void print_free_area()</div><div class="ttdoc">Print free areas in a tabular format, similar to the buddy allocator slides and examples. </div><div class="ttdef"><b>Definition:</b> <a href="buddy_8c_source.html#l00609">buddy.c:609</a></div></div>
<div class="ttc" id="buddy_8c_html_a8197baf99e89c859b5326a1d455680fd"><div class="ttname"><a href="buddy_8c.html#a8197baf99e89c859b5326a1d455680fd">buddy_alloc</a></div><div class="ttdeci">void * buddy_alloc(int size)</div><div class="ttdef"><b>Definition:</b> <a href="buddy_8c_source.html#l00218">buddy.c:218</a></div></div>
<div class="ttc" id="buddy_8c_html_a961ef8a2fd9df43d50945100f172b97a"><div class="ttname"><a href="buddy_8c.html#a961ef8a2fd9df43d50945100f172b97a">buddy_free</a></div><div class="ttdeci">void buddy_free(void *addr)</div><div class="ttdef"><b>Definition:</b> <a href="buddy_8c_source.html#l00395">buddy.c:395</a></div></div>
<div class="ttc" id="buddy_8c_html_a2f7a9bf73e255fb58bf8e57855e67532"><div class="ttname"><a href="buddy_8c.html#a2f7a9bf73e255fb58bf8e57855e67532">find_free_block</a></div><div class="ttdeci">block_t * find_free_block(int order)</div><div class="ttdoc">Locate and return a pointer to a free block in the given order among the free_area, or NULL if no such block exists. </div><div class="ttdef"><b>Definition:</b> <a href="buddy_8c_source.html#l00660">buddy.c:660</a></div></div>
<div class="ttc" id="structblock__t_html"><div class="ttname"><a href="structblock__t.html">block_t</a></div><div class="ttdef"><b>Definition:</b> <a href="buddy_8c_source.html#l00063">buddy.c:63</a></div></div>
<div class="ttc" id="structblock__t_html_a80d7be33d943c2f81034b125405a3dd4"><div class="ttname"><a href="structblock__t.html#a80d7be33d943c2f81034b125405a3dd4">block_t::list</a></div><div class="ttdeci">struct list_head list</div><div class="ttdef"><b>Definition:</b> <a href="buddy_8c_source.html#l00077">buddy.c:77</a></div></div>
<div class="ttc" id="structblock__t_html_aa2cbb00c1f450c796b741e1e5b0867bf"><div class="ttname"><a href="structblock__t.html#aa2cbb00c1f450c796b741e1e5b0867bf">block_t::address</a></div><div class="ttdeci">char * address</div><div class="ttdef"><b>Definition:</b> <a href="buddy_8c_source.html#l00080">buddy.c:80</a></div></div>
<div class="ttc" id="list_8h_html_a26c976b7f654e70df318c1843e5094de"><div class="ttname"><a href="list_8h.html#a26c976b7f654e70df318c1843e5094de">list_entry</a></div><div class="ttdeci">#define list_entry(ptr, type, member)</div><div class="ttdef"><b>Definition:</b> <a href="list_8h_source.html#l00190">list.h:190</a></div></div>
<div class="ttc" id="buddy_8c_html_a7c13b46aacf7af9976a7f058076c81a3"><div class="ttname"><a href="buddy_8c.html#a7c13b46aacf7af9976a7f058076c81a3">PAGE_TO_ADDR</a></div><div class="ttdeci">#define PAGE_TO_ADDR(page_idx)</div><div class="ttdef"><b>Definition:</b> <a href="buddy_8c_source.html#l00031">buddy.c:31</a></div></div>
<div class="ttc" id="buddy_8c_html_a77eea0047539c2e97bf94de50ccdf9f7"><div class="ttname"><a href="buddy_8c.html#a77eea0047539c2e97bf94de50ccdf9f7">buddy_dump_verbose</a></div><div class="ttdeci">void buddy_dump_verbose()</div><div class="ttdoc">Print a more useful and thorough dump of the free area. </div><div class="ttdef"><b>Definition:</b> <a href="buddy_8c_source.html#l00545">buddy.c:545</a></div></div>
<div class="ttc" id="list_8h_html_a0ffe9d28c36d7b018a9cfae33bae45c0"><div class="ttname"><a href="list_8h.html#a0ffe9d28c36d7b018a9cfae33bae45c0">INIT_LIST_HEAD</a></div><div class="ttdeci">#define INIT_LIST_HEAD(ptr)</div><div class="ttdef"><b>Definition:</b> <a href="list_8h_source.html#l00030">list.h:30</a></div></div>
<div class="ttc" id="structblock__t_html_a82acc515c2099fec50f6f0b41bfb19ad"><div class="ttname"><a href="structblock__t.html#a82acc515c2099fec50f6f0b41bfb19ad">block_t::order</a></div><div class="ttdeci">int order</div><div class="ttdef"><b>Definition:</b> <a href="buddy_8c_source.html#l00083">buddy.c:83</a></div></div>
<div class="ttc" id="buddy_8c_html_a6674e7c974485f8a5dd8874e9eb125f3"><div class="ttname"><a href="buddy_8c.html#a6674e7c974485f8a5dd8874e9eb125f3">buddy_init</a></div><div class="ttdeci">void buddy_init()</div><div class="ttdoc">Initialize a list of all possible addresses for the given MAX_ORDER, and set up a list element for th...</div><div class="ttdef"><b>Definition:</b> <a href="buddy_8c_source.html#l00157">buddy.c:157</a></div></div>
<div class="ttc" id="buddy_8c_html_a6d390a89d1f6c149cef6284d2c0351df"><div class="ttname"><a href="buddy_8c.html#a6d390a89d1f6c149cef6284d2c0351df">free_area</a></div><div class="ttdeci">struct list_head free_area[MAX_ORDER+1]</div><div class="ttdef"><b>Definition:</b> <a href="buddy_8c_source.html#l00096">buddy.c:96</a></div></div>
<div class="ttc" id="structblock__t_html_a623e67fc2865af94d9d86a7e99de20e4"><div class="ttname"><a href="structblock__t.html#a623e67fc2865af94d9d86a7e99de20e4">block_t::isFree</a></div><div class="ttdeci">int isFree</div><div class="ttdef"><b>Definition:</b> <a href="buddy_8c_source.html#l00086">buddy.c:86</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
